# Este arquivo deve ser usado para descrições dos modelos
# e para configurar testes

version: 2

models:

  # Contratos DBT

  ## Bronze
  - name: contratos
    description: >
      Tabela com informações sobre contratos, incluindo detalhes como o valor do contrato, a data de início e término, e o status do contrato.
      Esta tabela é fundamental para entender a execução e o cumprimento dos contratos firmados.
      A tabela é atualizada diariamente e contém dados de contratos firmados pelo IPEA.
      A tabela realiza validações e limpezas dos dados extraídos do ComprasGov, incluindo formatação adequada de valores numéricos,
      remoção de caracteres especiais em CPF/CNPJ e normalização de datas.
    columns:
      - name: id
        description: >
          Identificador único do contrato, utilizado para referenciar o contrato em outras tabelas e análises.
      - name: receita_despesa
        description: >
          Indica se o contrato é de receita ou despesa.
      - name: numero
        description: >
          Número do contrato no sistema ComprasGov.
      - name: fornecedor_tipo
        description: >
          Tipo do fornecedor (PF, PJ, IDGENERICO para empresas do exterior).
      - name: fornecedor_nome
        description: >
          Nome do fornecedor contratado.
      - name: tipo
        description: >
          Tipo de contrato (ex: Contrato, Empenho, Termo de Compromisso, etc.).
      - name: situacao
        description: >
          Situação atual do contrato (ex: Ativo, Inativo).
      - name: categoria
        description: >
          Categoria do contrato (ex: Informática, Serviços, Mão de Obra, Serviços de Engenharia, etc.).
      - name: objeto
        description: >
          Descrição do objeto contratado.
      - name: codigo_modalidade
        description: >
          Código que identifica a modalidade do contrato.
      - name: modalidade
        description: >
          Modalidade do contrato (ex: Pregão, Dispensa, Inexigibilidade, etc.).
      - name: num_parcelas
        description: >
          Número de parcelas para pagamento do contrato.
      - name: valor_inicial
        description: >
          Valor inicial do contrato, formatado como numérico.
      - name: valor_global
        description: >
          Valor total do contrato após eventuais aditivos, formatado como numérico.
      - name: valor_parcela
        description: >
          Valor de cada parcela do contrato, formatado como numérico.
      - name: valor_acumulado
        description: >
          Valor acumulado já realizado do contrato, formatado como numérico.
      - name: fornecedor_cnpj_cpf_idgener
        description: >
          CNPJ, CPF ou identificador genérico do fornecedor, com formatação padronizada para remoção de caracteres especiais.
      - name: processo
        description: >
          Número do processo administrativo relacionado ao contrato, formatado para remover caracteres especiais.
      - name: data_assinatura
        description: >
          Data em que o contrato foi assinado, validada e convertida para formato de data padrão.
      - name: data_publicacao
        description: >
          Data de publicação do contrato no Diário Oficial, validada e convertida para formato de data padrão.
      - name: vigencia_inicio
        description: >
          Data de início da vigência do contrato, validada e convertida para formato de data padrão.
      - name: vigencia_fim
        description: >
          Data de término da vigência do contrato, validada e convertida para formato de data padrão.
    data_tests: 
      - row_count_match:
          source_table: compras_gov.contratos
          target_table: contratos.contratos
      - verificacao_tipagem:
          nome_tabela: 'contratos.contratos'
          nome_coluna: 'num_parcelas'
          tipo_esperado: 'integer'
      - verificacao_tipagem:
          nome_tabela: 'contratos.contratos'
          nome_coluna: 'valor_inicial'
          tipo_esperado: 'numeric'
      - verificacao_tipagem:
          nome_tabela: 'contratos.contratos'
          nome_coluna: 'valor_global'
          tipo_esperado: 'numeric'
      - verificacao_tipagem:
          nome_tabela: 'contratos.contratos'
          nome_coluna: 'valor_parcela'
          tipo_esperado: 'numeric'
      - verificacao_tipagem:
          nome_tabela: 'contratos.contratos'
          nome_coluna: 'valor_acumulado'
          tipo_esperado: 'numeric'
      - verificacao_tipagem:
          nome_tabela: 'contratos.contratos'
          nome_coluna: 'data_assinatura'
          tipo_esperado: 'date'
      - verificacao_tipagem:
          nome_tabela: 'contratos.contratos'
          nome_coluna: 'data_publicacao'
          tipo_esperado: 'date'
      - verificacao_tipagem:
          nome_tabela: 'contratos.contratos'
          nome_coluna: 'data_proposta_comercial'
          tipo_esperado: 'date'
      - verificacao_tipagem:
          nome_tabela: 'contratos.contratos'
          nome_coluna: 'vigencia_inicio'
          tipo_esperado: 'date'
      - verificacao_tipagem:
          nome_tabela: 'contratos.contratos'
          nome_coluna: 'vigencia_fim'
          tipo_esperado: 'date'

  - name: cronogramas
    description: >
      Essa tabela contém informações sobre as despesas mensais programadas para cada contrato.
      Os dados são extraídos da tabela cronograma do ComprasGov, com valores formatados adequadamente.
      Apresenta o planejamento financeiro do contrato distribuído em parcelas mensais.
    columns:
      - name: id
        description: >
          Identificador único do cronograma.
      - name: contrato_id
        description: >
          Identificador do contrato relacionado ao cronograma.
      - name: tipo
        description: >
          Tipo de cada item do cronograma.
      - name: mesref
        description: >
          Mês de referência do cronograma.
      - name: anoref
        description: >
          Ano de referência do cronograma.
      - name: valor
        description: >
          Valor programado para o mês e ano de referência, formatado como numérico.
      - name: vencimento
        description: >
          Data de vencimento da parcela do cronograma.
    data_tests: 
      - verificacao_tipagem:
          nome_tabela: 'contratos.cronogramas'
          nome_coluna: 'id'
          tipo_esperado: 'integer'
      - verificacao_tipagem:
          nome_tabela: 'contratos.cronogramas'
          nome_coluna: 'contrato_id'
          tipo_esperado: 'integer'
      - verificacao_tipagem:
          nome_tabela: 'contratos.cronogramas'
          nome_coluna: 'mesref'
          tipo_esperado: 'integer'
      - verificacao_tipagem:
          nome_tabela: 'contratos.cronogramas'
          nome_coluna: 'anoref'
          tipo_esperado: 'integer'
      - verificacao_tipagem:
          nome_tabela: 'contratos.cronogramas'
          nome_coluna: 'valor'
          tipo_esperado: 'numeric'
      - verificacao_tipagem:
          nome_tabela: 'contratos.cronogramas'
          nome_coluna: 'vencimento'
          tipo_esperado: 'date'

  - name: faturas
    description: >
      Essa tabela contém informações sobre as faturas emitidas mensalmente de cada contrato.
      Os dados são extraídos da tabela faturas do ComprasGov com formatação adequada de valores numéricos e datas.
      A tabela inclui um processamento adicional para extrair informações dos empenhos a partir do campo JSON dados_empenho.
    columns:
      - name: id
        description: >
          Identificador único da fatura.
      - name: contrato_id
        description: >
          Identificador do contrato relacionado à fatura.
      - name: numero
        description: >
          Número da fatura emitida pelo fornecedor.
      - name: emissao
        description: >
          Data de emissão da fatura pelo fornecedor.
      - name: prazo
        description: >
          Data limite para pagamento da fatura.
      - name: vencimento
        description: >
          Data de vencimento da fatura.
      - name: valor
        description: >
          Valor bruto da fatura, formatado como numérico.
      - name: juros
        description: >
          Valor de juros aplicados à fatura, formatado como numérico.
      - name: multa
        description: >
          Valor de multa aplicada à fatura, formatado como numérico.
      - name: glosa
        description: >
          Valor de glosa aplicada à fatura, formatado como numérico.
      - name: valorliquido
        description: >
          Valor líquido da fatura após subtrações de glosas, multas ou juros, formatado como numérico.
      - name: situacao
        description: >
          Status atual da fatura (Pago ou Pendente).
      - name: mesref
        description: >
          Mês de referência da fatura.
      - name: anoref
        description: >
          Ano de referência da fatura.
      - name: id_empenho
        description: >
          Identificador do empenho extraído do campo JSON dados_empenho.
      - name: numero_empenho
        description: >
          Número do empenho relacionado à fatura, extraído do campo JSON dados_empenho e convertido para maiúsculas.
      - name: valor_empenho
        description: >
          Valor do empenho extraído do campo JSON dados_empenho.
    data_tests:
      - verificacao_tipagem:
          nome_tabela: 'contratos.faturas'
          nome_coluna: 'id'
          tipo_esperado: 'integer'
      - verificacao_tipagem:
          nome_tabela: 'contratos.faturas'
          nome_coluna: 'contrato_id'
          tipo_esperado: 'integer'
      - verificacao_tipagem:
          nome_tabela: 'contratos.faturas'
          nome_coluna: 'emissao'
          tipo_esperado: 'date'
      - verificacao_tipagem:
          nome_tabela: 'contratos.faturas'
          nome_coluna: 'prazo'
          tipo_esperado: 'date'
      - verificacao_tipagem:
          nome_tabela: 'contratos.faturas'
          nome_coluna: 'vencimento'
          tipo_esperado: 'date'
      - verificacao_tipagem:
          nome_tabela: 'contratos.faturas'
          nome_coluna: 'valor'
          tipo_esperado: 'numeric'
      - verificacao_tipagem:
          nome_tabela: 'contratos.faturas'
          nome_coluna: 'juros'
          tipo_esperado: 'numeric'
      - verificacao_tipagem:
          nome_tabela: 'contratos.faturas'
          nome_coluna: 'multa'
          tipo_esperado: 'numeric'
      - verificacao_tipagem:
          nome_tabela: 'contratos.faturas'
          nome_coluna: 'glosa'
          tipo_esperado: 'numeric'
      - verificacao_tipagem:
          nome_tabela: 'contratos.faturas'
          nome_coluna: 'valorliquido'
          tipo_esperado: 'numeric'
      - verificacao_tipagem:
          nome_tabela: 'contratos.faturas'
          nome_coluna: 'protocolo'
          tipo_esperado: 'date'
      - verificacao_tipagem:
          nome_tabela: 'contratos.faturas'
          nome_coluna: 'ateste'
          tipo_esperado: 'date'
      - verificacao_tipagem:
          nome_tabela: 'contratos.faturas'
          nome_coluna: 'mesref'
          tipo_esperado: 'integer'
      - verificacao_tipagem:
          nome_tabela: 'contratos.faturas'
          nome_coluna: 'anoref'
          tipo_esperado: 'integer'

  - name: empenhos
    description: >
      Essa tabela contém informações sobre os empenhos de cada contrato extraídos do ComprasGov.
      Os dados são formatados adequadamente para garantir consistência nos tipos numéricos e de data.
      Registra os compromissos de pagamento assumidos pela administração para cada contrato.
    columns:
      - name: id
        description: >
          Identificador único do empenho no ComprasGov.
      - name: contrato_id
        description: >
          Identificador do contrato relacionado ao empenho.
      - name: nota_empenho
        description: >
          Número da nota de empenho registrada no sistema.
      - name: credor
        description: >
          Nome ou razão social do credor do empenho.
      - name: credor_obj_cnpj_cpf_idgener
        description: >
          CNPJ, CPF ou identificador genérico do credor do empenho.
      - name: empenhado
        description: >
          Valor total empenhado, formatado como numérico.
      - name: aliquidar
        description: >
          Valor a liquidar do empenho, formatado como numérico.
      - name: liquidado
        description: >
          Valor já liquidado do empenho, formatado como numérico.
      - name: pago
        description: >
          Valor já pago do empenho, formatado como numérico.
      - name: rpinscrito
        description: >
          Valor inscrito em restos a pagar, formatado como numérico.
      - name: rpaliquidar
        description: >
          Valor inscrito em restos a pagar a liquidar, formatado como numérico.
      - name: rpliquidado
        description: >
          Valor inscrito em restos a pagar já liquidado, formatado como numérico.
      - name: rppago
        description: >
          Valor inscrito em restos a pagar já pago, formatado como numérico.
      - name: data_emissao
        description: >
          Data de emissão do empenho, validada e convertida para formato de data padrão.
    data_tests: 
      - row_count_match:
          source_table: compras_gov.empenhos
          target_table: contratos.empenhos
      - verificacao_tipagem:
          nome_tabela: 'contratos.empenhos'
          nome_coluna: 'empenhado'
          tipo_esperado: 'numeric'
      - verificacao_tipagem:
          nome_tabela: 'contratos.empenhos'
          nome_coluna: 'aliquidar'
          tipo_esperado: 'numeric'
      - verificacao_tipagem:
          nome_tabela: 'contratos.empenhos'
          nome_coluna: 'liquidado'
          tipo_esperado: 'numeric'
      - verificacao_tipagem:
          nome_tabela: 'contratos.empenhos'
          nome_coluna: 'pago'
          tipo_esperado: 'numeric'
      - verificacao_tipagem:
          nome_tabela: 'contratos.empenhos'
          nome_coluna: 'rpinscrito'
          tipo_esperado: 'numeric'
      - verificacao_tipagem:
          nome_tabela: 'contratos.empenhos'
          nome_coluna: 'rpaliquidar'
          tipo_esperado: 'numeric'
      - verificacao_tipagem:
          nome_tabela: 'contratos.empenhos'
          nome_coluna: 'rpliquidado'
          tipo_esperado: 'numeric'
      - verificacao_tipagem:
          nome_tabela: 'contratos.empenhos'
          nome_coluna: 'rppago'
          tipo_esperado: 'numeric'
      - verificacao_tipagem:
          nome_tabela: 'contratos.empenhos'
          nome_coluna: 'data_emissao'
          tipo_esperado: 'date'

  - name: empenhos_tesouro
    description: >
      Essa tabela contém informações sobre movimentação financeira dos empenhos extraídos do SIAFI.
      Contém dados de empenhos do Tesouro Nacional com formatação de valores financeiros através da macro parse_financial_value.
      Apresenta valores para as diferentes etapas da execução orçamentária (empenho, liquidação, pagamento).
    columns:
      - name: emissao_mes
        description: >
          Mês de emissão do empenho.
      - name: emissao_dia
        description: >
          Data específica de emissão do empenho.
      - name: ne_ccor
        description: >
          Número completo da nota de empenho no SIAFI.
      - name: ne_num_processo
        description: >
          Número do processo relacionado ao empenho, com formatação para remover caracteres especiais.
      - name: ne_info_complementar
        description: >
          Informações complementares sobre o empenho.
      - name: ne_ccor_favorecido
        description: >
          CNPJ ou CPF do favorecido, formatado em caixa alta.
      - name: ne_ccor_ano_emissao
        description: >
          Ano de emissão do empenho, filtrado para incluir apenas empenhos a partir do ano 2000.
      - name: despesas_empenhadas
        description: >
          Valor das despesas empenhadas, formatado como numérico.
      - name: despesas_liquidadas
        description: >
          Valor das despesas liquidadas, formatado como numérico.
      - name: despesas_pagas
        description: >
          Valor das despesas pagas, formatado como numérico.
      - name: restos_a_pagar_inscritos
        description: >
          Valor dos restos a pagar inscritos, formatado como numérico.
      - name: restos_a_pagar_pagos
        description: >
          Valor dos restos a pagar pagos, formatado como numérico.
    data_tests:
      - verificacao_tipagem:
          nome_tabela: 'contratos.empenhos_tesouro'
          nome_coluna: 'ne_ccor_ano_emissao'
          tipo_esperado: 'integer'
      - verificacao_tipagem:
          nome_tabela: 'contratos.empenhos_tesouro'
          nome_coluna: 'despesas_empenhadas'
          tipo_esperado: 'numeric'
      - verificacao_tipagem:
          nome_tabela: 'contratos.empenhos_tesouro'
          nome_coluna: 'despesas_liquidadas'
          tipo_esperado: 'numeric'
      - verificacao_tipagem:
          nome_tabela: 'contratos.empenhos_tesouro'
          nome_coluna: 'despesas_pagas'
          tipo_esperado: 'numeric'
      - verificacao_tipagem:
          nome_tabela: 'contratos.empenhos_tesouro'
          nome_coluna: 'restos_a_pagar_inscritos'
          tipo_esperado: 'numeric'
      - verificacao_tipagem:
          nome_tabela: 'contratos.empenhos_tesouro'
          nome_coluna: 'restos_a_pagar_pagos'
          tipo_esperado: 'numeric'

  - name: estagios
    description: >
      Essa tabela contém informações sobre os eventos de cada empenho discriminados por mês.
      Extrai dados da tabela estagios_tesouro do SIAFI com formatação e padronização para facilitar análises.
      Trata especificamente valores monetários com parênteses, convertendo-os para números negativos.
      Apresenta os diferentes estágios da despesa (empenho, liquidação, pagamento) ao longo do tempo.
    columns:
      - name: ne_ccor
        description: >
          Número completo da nota de empenho no SIAFI.
      - name: ne_informacao_complementar
        description: >
          Informações complementares sobre o empenho.
      - name: doc_observacao
        description: >
          Observações adicionais registradas no documento.
      - name: ne_ccor_favorecido
        description: >
          CNPJ ou CPF do favorecido do empenho.
      - name: mes_lancamento
        description: >
          Mês em que o lançamento foi registrado no SIAFI.
      - name: ne_num_processo
        description: >
          Número do processo relacionado ao empenho, formatado para remover caracteres especiais.
      - name: natureza_despesa
        description: >
          Código da natureza de despesa, convertido para integer quando possível.
      - name: natureza_despesa_detalhada
        description: >
          Código detalhado da natureza de despesa, convertido para integer quando possível.
      - name: ano_lancamento
        description: >
          Ano em que o lançamento foi registrado no SIAFI, convertido para integer quando possível.
      - name: ne_ccor_ano_emissao
        description: >
          Ano de emissão do empenho, convertido para integer quando possível.
      - name: despesas_empenhadas_controle_empenho_saldo_moeda_origem
        description: >
          Saldo das despesas empenhadas em moeda de origem, formatado como numérico.
      - name: despesas_empenhadas_controle_empenho_movim_liquido_moeda_origem
        description: >
          Movimento líquido das despesas empenhadas em moeda de origem, formatado como numérico.
      - name: despesas_liquidadas_controle_empenho_saldo_moeda_origem
        description: >
          Saldo das despesas liquidadas em moeda de origem, formatado como numérico.
      - name: despesas_liquidadas_controle_empenho_movim_liquido_moeda_origem
        description: >
          Movimento líquido das despesas liquidadas em moeda de origem, formatado como numérico.
      - name: despesas_pagas_controle_empenho_saldo_moeda_origem
        description: >
          Saldo das despesas pagas em moeda de origem, formatado como numérico.
      - name: despesas_pagas_controle_empenho_movim_liquido_moeda_origem
        description: >
          Movimento líquido das despesas pagas em moeda de origem, formatado como numérico.
    data_tests:
      - verificacao_tipagem:
          nome_tabela: 'contratos.estagios'
          nome_coluna: 'natureza_despesa'
          tipo_esperado: 'integer'
      - verificacao_tipagem:
          nome_tabela: 'contratos.estagios'
          nome_coluna: 'natureza_despesa_detalhada'
          tipo_esperado: 'integer'
      - verificacao_tipagem:
          nome_tabela: 'contratos.estagios'
          nome_coluna: 'ano_lancamento'
          tipo_esperado: 'integer'
      - verificacao_tipagem:
          nome_tabela: 'contratos.estagios'
          nome_coluna: 'ne_ccor_ano_emissao'
          tipo_esperado: 'integer'
      - verificacao_tipagem:
          nome_tabela: 'contratos.estagios'
          nome_coluna: 'despesas_empenhadas_controle_empenho_saldo_moeda_origem'
          tipo_esperado: 'numeric'
      - verificacao_tipagem:
          nome_tabela: 'contratos.estagios'
          nome_coluna: 'despesas_empenhadas_controle_empenho_movim_liquido_moeda_origem'
          tipo_esperado: 'numeric'
      - verificacao_tipagem:
          nome_tabela: 'contratos.estagios'
          nome_coluna: 'despesas_liquidadas_controle_empenho_saldo_moeda_origem'
          tipo_esperado: 'numeric'
      - verificacao_tipagem:
          nome_tabela: 'contratos.estagios'
          nome_coluna: 'despesas_liquidadas_controle_empenho_movim_liquido_moeda_origem'
          tipo_esperado: 'numeric'
      - verificacao_tipagem:
          nome_tabela: 'contratos.estagios'
          nome_coluna: 'despesas_pagas_controle_empenho_saldo_moeda_origem'
          tipo_esperado: 'numeric'
      - verificacao_tipagem:
          nome_tabela: 'contratos.estagios'
          nome_coluna: 'despesas_pagas_controle_empenho_movim_liquido_moeda_origem'
          tipo_esperado: 'numeric'

  ## Silver
  - name: contratos_empenhos
    description: >
      Essa tabela combina as informações de movimentação financeira dos empenhos com os ids de contrato do IPEA.
      Realiza uma complexa estratégia de join entre os contratos e empenhos do tesouro, tentando várias abordagens
      para relacionar os dados do SIAFI com os contratos do ComprasGov usando: 
      1) número de empenho e CNPJ/CPF, 2) número de processo, 3) CNPJ/CPF único, e 4) informação complementar.
    columns:
      - name: contrato_id
        description: >
          Identificador único do contrato relacionado ao empenho.
      - name: ne_transformed
        description: >
          Número da nota de empenho padronizado para facilitar joins entre diferentes fontes.
      - name: ne_ccor
        description: >
          Número completo da nota de empenho no SIAFI.
      - name: ne_info_complementar
        description: >
          Informações complementares sobre o empenho no SIAFI.
      - name: ne_num_processo
        description: >
          Número do processo administrativo relacionado ao empenho, formatado para remover caracteres especiais.
      - name: ne_ccor_descricao
        description: >
          Descrição da nota de empenho conforme registrado no SIAFI.
      - name: doc_observacao
        description: >
          Observações registradas no documento do empenho.
      - name: natureza_despesa
        description: >
          Código da natureza da despesa do empenho.
      - name: natureza_despesa_descricao
        description: >
          Descrição da natureza da despesa do empenho.
      - name: ne_ccor_favorecido
        description: >
          CNPJ ou CPF do favorecido do empenho.
      - name: ne_ccor_ano_emissao
        description: >
          Ano de emissão do empenho.
      - name: despesas_empenhadas
        description: >
          Valor total das despesas empenhadas para o contrato.
      - name: despesas_liquidadas
        description: >
          Valor total das despesas liquidadas para o contrato.
      - name: despesas_pagas
        description: >
          Valor total das despesas pagas para o contrato.

  - name: contratos_estagios
    description: >
      Essa tabela combina as informações de movimentação financeira dos empenhos com os ids de contrato do IPEA mensalmente.
      Utiliza uma estratégia de join em cascata, tentando correlacionar os estágios das despesas do SIAFI com os 
      contratos do ComprasGov através de várias combinações de chaves, incluindo número de empenho, CNPJ/CPF, número 
      de processo e informações complementares.
    columns:
      - name: contrato_id
        description: >
          Identificador único do contrato relacionado aos estágios.
      - name: mes_lancamento
        description: >
          Mês em que o estágio da despesa foi registrado no SIAFI.
      - name: valor_empenhado
        description: >
          Valor empenhado no mês de referência para o contrato.
      - name: valor_liquidado
        description: >
          Valor liquidado no mês de referência para o contrato.
      - name: valor_pago
        description: >
          Valor pago no mês de referência para o contrato.

  - name: estagios_mensal
    description: >
      Essa tabela discrimina os valores empenhados, liquidados e pagos mensalmente extraídos do SIAFI para cada contrato.
      Transforma e agrega os dados da tabela empenhos_tesouro do SIAFI, padronizando formatos e consolidando valores 
      por número de empenho, mês e CNPJ/CPF.
    columns:
      - name: ne
        description: >
          Número da nota de empenho no formato padronizado, extraído das 12 últimas posições do ne_ccor.
      - name: mes_lancamento
        description: >
          Mês de referência do lançamento, convertido para formato de data padrão.
      - name: cnpj_cpf
        description: >
          CNPJ ou CPF do favorecido do empenho.
      - name: info_complementar
        description: >
          Informação complementar extraída do ne_info_complementar.
      - name: num_processo
        description: >
          Número do processo administrativo relacionado ao empenho.
      - name: valor_empenhado
        description: >
          Valor total empenhado no mês e para o empenho específico.
      - name: valor_liquidado
        description: >
          Valor total liquidado no mês e para o empenho específico.
      - name: valor_pago
        description: >
          Valor total pago no mês e para o empenho específico.

  - name: contratos_faturas
    description: >
      Essa tabela integra informações detalhadas de faturas com dados dos contratos relacionados.
      Permite uma visão completa de cada fatura no contexto do seu contrato, incluindo dados como número de contrato,
      processo, objeto e fornecedor. Facilita a análise financeira das faturas em conjunto com seus respectivos contratos.
    columns:
      - name: id
        description: >
          Identificador único da fatura.
      - name: contrato_id
        description: >
          Identificador do contrato relacionado à fatura.
      - name: numero_contrato
        description: >
          Número do contrato no sistema ComprasGov.
      - name: contrato_processo
        description: >
          Número do processo administrativo relacionado ao contrato.
      - name: fornecedor_cnpj_cpf_idgener
        description: >
          CNPJ, CPF ou identificador genérico do fornecedor do contrato.
      - name: objeto_contrato
        description: >
          Descrição do objeto contratado.
      - name: tipolistafatura_id
        description: >
          Identificador do tipo de lista de fatura.
      - name: justificativafatura_id
        description: >
          Identificador da justificativa da fatura, quando aplicável.
      - name: sfadrao_id
        description: >
          Identificador do padrão de sistema financeiro relacionado.
      - name: numero
        description: >
          Número da fatura emitida pelo fornecedor.
      - name: emissao
        description: >
          Data de emissão da fatura.
      - name: prazo
        description: >
          Data limite para pagamento da fatura.
      - name: vencimento
        description: >
          Data de vencimento da fatura.
      - name: valor
        description: >
          Valor bruto da fatura.
      - name: juros
        description: >
          Valor de juros aplicados à fatura.
      - name: multa
        description: >
          Valor de multa aplicada à fatura.
      - name: glosa
        description: >
          Valor de glosa aplicada à fatura.
      - name: valorliquido
        description: >
          Valor líquido da fatura após subtrações de glosas, multas ou juros.
      - name: processo
        description: >
          Número do processo administrativo específico da fatura, quando diferente do processo do contrato.
      - name: protocolo
        description: >
          Data de protocolo da fatura no sistema.
      - name: ateste
        description: >
          Data em que a fatura foi atestada, confirmando a entrega do produto ou serviço.
      - name: repactuacao
        description: >
          Indica se a fatura está relacionada a uma repactuação contratual.
      - name: infcomplementar
        description: >
          Informações complementares sobre a fatura.
      - name: mesref
        description: >
          Mês de referência da fatura.
      - name: anoref
        description: >
          Ano de referência da fatura.
      - name: situacao
        description: >
          Status atual da fatura (Pago ou Pendente).
      - name: chave_nfe
        description: >
          Chave da Nota Fiscal Eletrônica associada à fatura, quando disponível.
      - name: dados_referencia
        description: >
          Dados de referência adicionais da fatura, geralmente em formato JSON.
      - name: dados_item_faturado
        description: >
          Detalhamento dos itens faturados, geralmente em formato JSON.
      - name: dados_empenho
        description: >
          Informações sobre o empenho relacionado à fatura, em formato JSON.
      - name: id_empenho
        description: >
          Identificador do empenho extraído do campo JSON dados_empenho.
      - name: numero_empenho
        description: >
          Número do empenho relacionado à fatura.
      - name: valor_empenho
        description: >
          Valor do empenho relacionado à fatura.
      - name: subelemento
        description: >
          Código do subelemento de despesa relacionado à fatura.

  - name: cronogramas_fatura_mensal
    description: >
      Essa tabela discrimina os valores programados e faturados mensalmente pelo ComprasGov para cada contrato.
      Combina dados dos cronogramas com as faturas pagas e pendentes, agrupando por contrato e mês de referência,
      e calculando o saldo contratual disponível (diferença entre o valor programado e os valores faturados).
    columns:
      - name: contrato_id
        description: >
          Identificador único do contrato.
      - name: mes_ref
        description: >
          Mês de referência dos valores programados e faturados.
      - name: valor_cronograma
        description: >
          Valor total programado para o mês de referência conforme cronograma do contrato.
      - name: valor_faturas_pagas
        description: >
          Valor total de faturas com status "Pago" no mês de referência.
      - name: valor_faturas_pendentes
        description: >
          Valor total de faturas com status "Pendente" no mês de referência.
      - name: saldo_contratual_disponivel
        description: >
          Diferença entre o valor programado no cronograma e a soma dos valores faturados (pagos e pendentes).

  ## Golds
  - name: contratos_resumo
    description: >
      Essa tabela contém um resumo dos contratos, informações contratuais como valor global e valor pago, 
      e situação atual, como em vigência ou pendente de baixa.
      Facilita a análise gerencial dos contratos com indicadores chave como status de pagamento, tipo de fornecedor,
      e identificação de contratos continuados (com vigência superior a dois anos e mais de uma parcela).
    columns:
      - name: contrato_id
        description: >
          Identificador único do contrato.
      - name: fornecedor_cnpj_cpf
        description: >
          CNPJ ou CPF do fornecedor contratado, com formatação padronizada.
      - name: numero
        description: >
          Número do contrato no sistema ComprasGov.
      - name: categoria
        description: >
          Categoria do contrato (ex: Informática, Serviços, Mão de Obra).
      - name: modalidade
        description: >
          Modalidade de licitação utilizada na contratação.
      - name: tipo
        description: >
          Tipo de contrato (ex: Contrato, Empenho, Termo de Compromisso).
      - name: situacao
        description: >
          Situação atual do contrato (Ativo ou Inativo).
      - name: pendente_baixa
        description: >
          Indica se o contrato está pendente de baixa ('Sim' quando o valor pago for igual ao valor global, 'Não' caso contrário).
      - name: fornecedor_nome
        description: >
          Nome ou razão social do fornecedor contratado.
      - name: objeto
        description: >
          Descrição detalhada do objeto contratado.
      - name: valor_global
        description: >
          Valor total do contrato após eventuais aditivos.
      - name: despesas_pagas
        description: >
          Valor total já pago do contrato conforme registros do SIAFI.
      - name: vigencia_inicio
        description: >
          Data de início da vigência do contrato.
      - name: vigencia_fim
        description: >
          Data de término da vigência do contrato.
      - name: num_parcelas
        description: >
          Número de parcelas para pagamento do contrato.
      - name: fornecedor_tipo
        description: >
          Tipo do fornecedor, categorizado como 'Empresa do Exterior' para IDGENERICO.
      - name: Unidade
        description: >
          Unidade gestora responsável pelo contrato, no formato "código - nome_resumido".
      - name: continuado
        description: >
          Indica se o contrato é de prestação continuada ('Sim' quando a vigência for maior que 730 dias e tiver mais de uma parcela).

  - name: contratos_comparativo_mensal
    description: >
      Essa tabela contém um comparativo mensal dos contratos, discriminando 
      os valores empenhados, liquidados e pagos do SIAFI, 
      programados e faturados do ComprasGov.
      Permite a identificação de inconsistências entre os sistemas e o acompanhamento detalhado 
      da execução financeira mensal de cada contrato.
    columns:
      - name: contrato_id
        description: >
          Identificador único do contrato.
      - name: mes_ref
        description: >
          Mês de referência da informação financeira, preenchido para todos os meses entre o início e fim do contrato.
      - name: comprasgov_valor_cronograma
        description: >
          Valor programado para o mês conforme cronograma registrado no ComprasGov.
      - name: comprasgov_valor_faturas
        description: >
          Soma dos valores das faturas (pagas e pendentes) no mês de referência conforme ComprasGov.
      - name: comprasgov_saldo_contratual_disponivel
        description: >
          Diferença entre o valor programado e o valor faturado no mês, indicando o saldo disponível.
      - name: siafi_valor_empenhado
        description: >
          Valor empenhado no mês de referência conforme registros do SIAFI.
      - name: siafi_valor_liquidado
        description: >
          Valor liquidado no mês de referência conforme registros do SIAFI.
      - name: siafi_valor_pago
        description: >
          Valor pago no mês de referência conforme registros do SIAFI.

  - name: contratos_somatorio
    description: >
      Essa tabela contém somatórios dos valores de cronograma, fatura, empenho, liquidação e pagamento para cada contrato.
      Facilita análises agregadas sobre a execução financeira total de cada contrato, com indicadores importantes 
      como o orçamento pendente de execução.
    columns:
      - name: contrato_id
        description: >
          Identificador único do contrato.
      - name: total_cronograma
        description: >
          Soma de todos os valores programados no cronograma do contrato.
      - name: total_faturas
        description: >
          Soma de todos os valores faturados (pagos e pendentes) para o contrato.
      - name: total_saldo_disponivel
        description: >
          Diferença total entre valores programados e faturados, indicando o saldo contratual disponível.
      - name: orcamento_a_executar
        description: >
          Soma dos valores programados em meses onde ainda não houve faturamento, indicando o orçamento pendente de execução.
      - name: total_empenhado
        description: >
          Soma de todos os valores empenhados para o contrato segundo o SIAFI.
      - name: total_liquidado
        description: >
          Soma de todos os valores liquidados para o contrato segundo o SIAFI.
      - name: total_pago
        description: >
          Soma de todos os valores pagos para o contrato segundo o SIAFI.

  ## View
  - name: identificadores
    description: >
      Essa tabela contém os identificadores dos contratos, empenhos e faturas.
      Consolida os números de empenho encontrados em diferentes fontes (contratos, faturas, empenhos) 
      e padroniza informações como processo e CNPJ/CPF para facilitar joins entre as tabelas.
      Também cria um campo info_complementar que combina unidade gestora, modalidade e número de contrato/licitação.
    columns:
      - name: contrato_id
        description: >
          Identificador único do contrato.
      - name: categoria
        description: >
          Categoria do contrato (ex: Informática, Serviços, Mão de Obra).
      - name: processo
        description: >
          Número do processo administrativo do contrato, formatado para remover caracteres não numéricos.
      - name: cnpj_cpf
        description: >
          CNPJ ou CPF do fornecedor, formatado para remover caracteres especiais como barras, pontos e hífens.
      - name: info_complementar
        description: >
          Informação complementar construída a partir da unidade gestora, código de modalidade e número do contrato ou licitação.
      - name: ne
        description: >
          Número da nota de empenho relacionada ao contrato, combinando informações de contratos, empenhos e faturas.

  # SIAPE DBT
  ## Bronze 
  - name: lista_uorgs 
    description: >
      Modelo bronze para dados de uorg. Inclui limpeza básica, tipagem, transformação de datas
    columns:
      - name: codigo 
        description: >
          codigo da uorg
      - name: dt_ultima_transacao
        description: >
          data da última transação
      - name: nome
        description: >
          nome

  - name: lista_servidores 
    description: >
      Modelo bronze para dados de servidores. Inclui limpeza básica, tipagem, transformação de datas
    columns:
      - name: cod_uorg 
        description: >
          codigo da uorg
      - name: dt_ultima_transacao
        description: >
          data da última transação
      - name: cpf
        description: >
          registro pessoa física

  - name: dados_uorg 
    description: >
      Tabela bronze contendo dados de Unidades Organizacionais (UORG),
      após limpeza básica, padronização de tipos e formatos a partir da fonte bruta.
      Esta tabela serve como uma representação fiel e limpa dos dados de origem.
    columns:
      - name: bairro_uorg
        description: >
          Bairro do endereço da UORG.
        data_type: varchar

      - name: cep_uorg
        description: >
          CEP (Código de Endereçamento Postal) da UORG,
          contendo apenas dígitos (limpo).
        data_type: varchar(8)
        # tests:
        #   - dbt_utils.equal_length:
        #       value: 8
        #       config:
        #         severity: warn

      - name: codigo_matricula
        description: >
          Código de matrícula associado à UORG.
          Pode conter zeros à esquerda ou ser alfanumérico.
        data_type: varchar
        # tests:
        #   - not_null

      - name: codigo_municipio_uorg
        description: >
          Código do município da UORG.
        data_type: varchar

      - name: codigo_orgao
        description: >
          Código do órgão ao qual a UORG pertence.
        data_type: varchar

      - name: codigo_orgao_uorg
        description: >
          Código identificador único da UORG dentro do órgão.
        data_type: varchar
        # tests:
        #   - not_null
        #   - unique

      - name: email_uorg
        description: >
          Endereço de e-mail da UORG, padronizado para minúsculas.
        data_type: varchar
        # tests:
        #   - dbt_utils.expression_is_true:
        #       expression: > # Exemplo de como aplicar em expressões também
        #         email_uorg LIKE '%@%.%'
        #       config:
        #         severity: warn

      - name: tipo_endereco_uorg
        description: >
          Tipo ou descrição principal do endereço da UORG (ex: ENDERECO PRINCIPAL).
        data_type: varchar

      - name: logradouro_uorg
        description: >
          Logradouro (rua, avenida, etc.) do endereço da UORG.
        data_type: varchar

      - name: nome_municipio_uorg
        description: >
          Nome do município onde a UORG está localizada.
        data_type: varchar

      - name: nome_uorg
        description: >
          Nome completo da Unidade Organizacional (UORG).
        data_type: varchar
        tests:
          - not_null

      - name: telefone_uorg
        description: >
          Número de telefone da UORG, contendo apenas dígitos (limpo).
        data_type: varchar

      - name: numero_endereco_uorg
        description: >
          Número do endereço da UORG. Pode conter 'S/N' para 'Sem Número'.
        data_type: varchar

      - name: sigla_uorg
        description: >
          Sigla ou nome curto da UORG.
        data_type: varchar

      - name: uf_uorg
        description: >
          Sigla da Unidade Federativa (Estado) da UORG, padronizada para maiúsculas.
        data_type: varchar(2)

      - name: cpf
        description: >
          CPF associado à UORG, contendo apenas os 11 dígitos (limpo).
        data_type: varchar(11)
        # tests:
          # - dbt_utils.equal_length:
          #     value: 11
          #     config:
          #       severity: warn

      - name: complemento_endereco_uorg
        description: >
          Complemento do endereço da UORG (ex: Sala, Bloco, Apartamento).
        data_type: varchar

      - name: fax_uorg
        description: >
          Número de fax da UORG, contendo apenas dígitos (limpo).
        data_type: varchar

  - name: dados_pessoais
    description: >
      Tabela bronze contendo dados pessoais de indivíduos, após limpeza básica,
      padronização de tipos e formatos a partir da fonte bruta.
    columns:
      - name: cod_cor
        description: >
          Código da cor/raça do indivíduo.
        data_type: varchar
        # tests:
        #   - not_null

      - name: cod_estado_civil
        description: >
          Código do estado civil do indivíduo.
        data_type: varchar

      - name: cod_nacionalidade
        description: >
          Código da nacionalidade do indivíduo.
        data_type: varchar

      - name: cod_sexo
        description: >
          Código do sexo do indivíduo (ex: M, F).
        data_type: varchar(1) 

      - name: dt_nascimento
        description: >
          Data de nascimento do indivíduo, convertida para o tipo DATE.
        data_type: date
        # tests:
        #   - not_null

      - name: grupo_sanguineo
        description: >
          Grupo sanguíneo e fator RH do indivíduo (ex: A +, O -).
        data_type: varchar

      - name: nome_pessoa
        description: >
          Nome completo do indivíduo.
        data_type: varchar
        # tests:
        #   - not_null

      - name: nome_cor
        description: >
          Nome descritivo da cor/raça do indivíduo.
        data_type: varchar

      - name: nome_estado_civil
        description: >
          Nome descritivo do estado civil do indivíduo.
        data_type: varchar

      - name: nome_mae
        description: >
          Nome completo da mãe do indivíduo.
        data_type: varchar

      - name: nome_municipio_nascimento
        description: >
          Nome do município de nascimento do indivíduo.
        data_type: varchar

      - name: nome_nacionalidade
        description: >
          Nome descritivo da nacionalidade do indivíduo (ex: BRASILEIRO NATO).
        data_type: varchar

      - name: nome_pai
        description: >
          Nome completo do pai do indivíduo. 'NAO DECLARADO' é convertido para NULL.
        data_type: varchar

      - name: nome_sexo
        description: >
          Nome descritivo do sexo do indivíduo (ex: MASCULINO, FEMININO).
        data_type: varchar

      - name: num_pispasep
        description: >
          Número do PIS/PASEP do indivíduo, contendo apenas dígitos.
        data_type: varchar # Para preservar zeros à esquerda e pelo tamanho
        # tests:
        #   - dbt_utils.equal_length:
        #       value: 11 # PIS/PASEP tem 11 dígitos

      - name: uf_nascimento
        description: >
          Sigla da Unidade Federativa (Estado) de nascimento, padronizada para maiúsculas.
        data_type: varchar(2)
        # tests:
        #   - dbt_utils.equal_length:
        #       value: 2

      - name: cpf
        description: >
          CPF do indivíduo, contendo apenas os 11 dígitos.
        data_type: varchar(11)
        # tests:
        #   - not_null
        #   - unique
        #   - dbt_utils.equal_length:
        #       value: 11

      - name: cod_deficiencia_fisica
        description: >
          Código da deficiência física, se houver.
        data_type: varchar

      - name: nome_deficiencia_fisica
        description: >
          Nome da deficiência física, se houver.
        data_type: varchar

      - name: dt_chegada_brasil
        description: >
          Data de chegada ao Brasil (para estrangeiros), convertida para o tipo DATE.
        data_type: date

      - name: nome_pais_origem
        description: >
          Nome do país de origem (para estrangeiros).
        data_type: varchar
    
  - name: dados_pa
    description: >
      Tabela bronze contendo dados de beneficiários de pensões e informações relacionadas,
      após limpeza básica e padronização de formatos a partir da fonte bruta.

    columns:
      - name: agencia_beneficiario
        description: >
          Código da agência bancária do beneficiário, contendo apenas dígitos.
        data_type: varchar
        # tests:
        #   - not_null

      - name: banco_beneficiario
        description: >
          Código do banco do beneficiário.
        data_type: varchar
        # tests:
        #   - not_null

      - name: cod_orgao
        description: >
          Código do órgão pagador.
        data_type: varchar
        # tests:
        #   - not_null

      - name: conta_beneficiario
        description: >
          Número da conta bancária do beneficiário, limpo e padronizado para maiúsculas
        data_type: varchar
        # tests:
        #   - not_null

      - name: cpf_beneficiario
        description: >
          CPF do beneficiário, contendo apenas dígitos.
          Pode ter comprimento variável se a fonte não for padronizada para 11 dígitos.
        data_type: varchar
        # tests:
        #   - not_null

      - name: matricula_servidor
        description: >
          Matrícula do servidor ao qual a pensão está vinculada.
        data_type: varchar
        # tests:
        #   - not_null

      - name: nome_beneficiario
        description: >
          Nome completo do beneficiário da pensão.
        data_type: varchar
        # tests:
        #   - not_null

      - name: valor_ultima_pensao
        description: >
          Valor da última pensão registrada, como string.
        data_type: varchar

      - name: cpf_servidor
        description: >
          CPF do servidor ao qual a pensão está vinculada, contendo apenas os 11 dígitos.
        data_type: varchar(11)
        # tests:
        #   - not_null
        #   - dbt_utils.equal_length:
        #       value: 11

      - name: cod_vinculo_servidor
        description: >
          Código do tipo de vínculo do alimentado com o servidor.
        data_type: varchar

      - name: nome_alimentado
        description: >
          Nome da pessoa alimentada (dependente/beneficiário da pensão, se diferente do beneficiário principal).
        data_type: varchar

      - name: nome_vinculo_servidor
        description: >
          Nome descritivo do tipo de vínculo do alimentado com o servidor (ex: FILHO(A), EX-CONJUGE).
        data_type: varchar

  # Pessoas DBT

  # TED DBT
  - name: pf_tesouro
    description: >
      Esta tabela contém registros de Programações Financeiras extraídas do SIAFI, detalhando informações como tipo de programação, data de execução e valor. 
      A tabela é atualizada diariamente e reflete as autorizações de movimentação financeira no âmbito da execução orçamentária federal.
    columns:
    - name: emissao_mes
      description: >
        Mês de emissão da Programação Financeira.
    - name: emissao_dia
      description: >
        Dia de emissão da Programação Financeira.
    - name: ug_emitente
      description: >
        Código da Unidade Gestora responsável pela emissão da Programação Financeira.
    - name: ug_emitente_descricao
      description: >
        Nome ou descrição da Unidade Gestora emitente da Programação Financeira.
    - name: ug_favorecido
      description: >
        Código da Unidade Gestora favorecida pela Programação Financeira.
    - name: ug_favorecido_descricao
      description: >
        Nome ou descrição da Unidade Gestora favorecida pela Programação Financeira.
    - name: pf_evento
      description: >
        Código do evento contábil associado à Programação Financeira, representando a natureza da transação.
    - name: pf_evento_descricao
      description: >
        Descrição do evento contábil vinculado à Programação Financeira.
    - name: pf
      description: >
        Número identificador único da Programação Financeira.
    - name: pf_inscricao
      description: >
        Número de inscrição da Programação Financeira, utilizado para controle e acompanhamento.
    - name: pf_acao
      description: >
        Código da ação orçamentária associada à Programação Financeira.
    - name: pf_acao_descricao
      description: >
        Descrição da ação orçamentária vinculada à Programação Financeira.
    - name: pf_fonte_recursos
      description: >
        Código da fonte de recursos associada à Programação Financeira, indicando a origem dos recursos utilizados.
    - name: pf_fonte_recursos_descricao
      description: >
        Descrição textual da fonte de recursos vinculada à Programação Financeira.
    - name: pf_vinculacao_pagamento
      description: >
        Código da vinculação de pagamento associada à Programação Financeira.
    - name: pf_vinculacao_pagamento_descricao
      description: >
        Descrição da vinculação de pagamento vinculada à Programação Financeira.
    - name: pf_categoria_gasto
      description: >
        Código da categoria de gasto associada à Programação Financeira, conforme classificação orçamentária.
    - name: pf_recurso
      description: >
        Código do recurso associado à Programação Financeira.
    - name: pf_recurso_descricao
      description: >
        Descrição do recurso vinculado à Programação Financeira.
    - name: doc_observacao
      description: >
        Observações adicionais relacionadas à Programação Financeira.
    - name: pf_valor_linha
      description: >
        Valor monetário individual da linha da Programação Financeira.
    data_tests:
        - verificacao_tipagem:
            nome_tabela: 'ted.pf_tesouro'
            nome_coluna: 'emissao_dia'
            tipo_esperado: 'date'
        - verificacao_tipagem:
            nome_tabela: 'ted.pf_tesouro'
            nome_coluna: 'pf_valor_linha'
            tipo_esperado: 'numeric'

  - name: nc_tesouro
    description: >
      Esta tabela registra informações detalhadas sobre as Notas de Crédito emitidas no âmbito da execução orçamentária e financeira do governo federal. 
      As Notas de Crédito representam autorizações para a realização de despesas, sendo fundamentais para o controle e acompanhamento da execução orçamentária.
    columns:
    - name: emissao_mes
      description: >
        Mês de emissão da Nota de Crédito.
    - name: emissao_dia
      description: >
        Dia de emissão da Nota de Crédito.
    - name: nc
      description: >
        Número identificador único da Nota de Crédito.
    - name: nc_transferencia
      description: >
        Indicador de que a Nota de Crédito refere-se a uma transferência de recursos entre unidades gestoras.
    - name: nc_fonte_recursos
      description: >
        Código da fonte de recursos associada à Nota de Crédito, indicando a origem dos recursos utilizados.
    - name: nc_fonte_recursos_descricao
      description: >
        Descrição textual da fonte de recursos vinculada à Nota de Crédito.
    - name: ptres
      description: >
        Código do Plano Interno de Trabalho (PTRES) relacionado à Nota de Crédito, utilizado para detalhar a alocação dos recursos.
    - name: nc_evento
      description: >
        Código do evento contábil associado à Nota de Crédito, representando a natureza da transação.
    - name: nc_evento_descricao
      description: >
        Descrição do evento contábil vinculado à Nota de Crédito.
    - name: ug_responsavel
      description: >
        Código da Unidade Gestora responsável pela emissão da Nota de Crédito.
    - name: ug_responsavel_descricao
      description: >
        Nome ou descrição da Unidade Gestora responsável pela emissão da Nota de Crédito.
    - name: natureza_despesa
      description: >
        Código da natureza da despesa associada à Nota de Crédito, conforme classificação orçamentária.
    - name: natureza_despesa_detalhada
      description: >
        Descrição detalhada da natureza da despesa vinculada à Nota de Crédito.
    - name: plano_interno
      description: >
        Código do plano interno relacionado à Nota de Crédito, utilizado para controle interno da execução orçamentária.
    - name: plano_detalhado_descricao1
      description: >
        Primeira descrição detalhada do plano interno associado à Nota de Crédito.
    - name: plano_detalhado_descricao2
      description: >
        Segunda descrição detalhada do plano interno associado à Nota de Crédito.
    - name: favorecido_doc
      description: >
        Documento de identificação (CPF ou CNPJ) do favorecido pela Nota de Crédito.
    - name: favorecido_doc_descricao
      description: >
        Nome ou razão social do favorecido identificado na Nota de Crédito.
    - name: nc_valor_linha
      description: >
        Valor monetário individual da linha da Nota de Crédito.
    - name: movimento_liquido
      description: >
        Valor líquido do movimento financeiro associado à Nota de Crédito, após deduções ou acréscimos aplicáveis.

  - name: planos_acao
    description: >
      Esta tabela armazena informações detalhadas sobre os Planos de Ação vinculados a programas públicos.
      Ela consolida dados sobre as unidades envolvidas na execução, prazos de vigência, valores, justificativas,
      formas de execução e instrumentos utilizados. Serve como base para o acompanhamento, análise e auditoria 
      da implementação de ações públicas em diferentes formatos de execução.
    columns:
    - name: id_plano_acao
      description: >
        Identificador único do Plano de Ação.
    - name: id_programa
      description: >
        Identificador único do programa ao qual o Plano de Ação está vinculado.
    - name: sigla_unidade_descentralizada
      description: >
        Sigla da unidade descentralizada responsável pelo Plano de Ação.
    - name: unidade_descentralizada
      description: >
        Nome completo da unidade descentralizada responsável pelo Plano de Ação.
    - name: sigla_unidade_responsavel_execucao
      description: >
        Sigla da unidade responsável pela execução do Plano de Ação.
    - name: unidade_responsavel_execucao
      description: >
        Nome completo da unidade responsável pela execução do Plano de Ação.
    - name: vl_total_plano_acao
      description: >
        Valor total previsto para execução do Plano de Ação.
    - name: dt_inicio_vigencia
      description: >
        Data de início da vigência do Plano de Ação.
    - name: dt_fim_vigencia
      description: >
        Data final da vigência do Plano de Ação.
    - name: tx_objeto_plano_acao
      description: >
        Descrição do objeto do Plano de Ação, informando seu propósito e escopo.
    - name: tx_justificativa_plano_acao
      description: >
        Justificativa para a elaboração e execução do Plano de Ação.
    - name: in_forma_execucao_direta
      description: >
        Indicador booleano que sinaliza se a execução do plano ocorrerá de forma direta.
    - name: in_forma_execucao_particulares
      description: >
        Indicador booleano que sinaliza se a execução contará com a participação de particulares.
    - name: in_forma_execucao_descentralizada
      description: >
        Indicador booleano que sinaliza se a execução será realizada de forma descentralizada.
    - name: tx_situacao_plano_acao
      description: >
        Situação atual do Plano de Ação (ex: em elaboração, aprovado, em execução, concluído).
    - name: aa_ano_plano_acao
      description: >
        Ano de referência do Plano de Ação.
    - name: vl_beneficiario_especifico
      description: >
        Valor destinado especificamente a beneficiários definidos no Plano de Ação.
    - name: vl_chamamento_publico
      description: >
        Valor previsto para execução por meio de chamamento público.
    - name: sq_instrumento
      description: >
        Código sequencial do instrumento jurídico ou administrativo associado ao Plano de Ação.
    - name: aa_instrumento
      description: >
        Ano de referência do instrumento associado ao Plano de Ação.

  - name: nota_credito
    description: >
      Esta tabela contém informações sobre as Notas de Crédito emitidas no contexto dos Planos de Ação.
      As notas de crédito representam movimentações financeiras entre unidades gestoras e gestões, sendo 
      vinculadas a um Plano de Ação específico. A tabela registra dados como número, data de emissão, 
      códigos das unidades e gestões envolvidas, além de observações e situação da nota.
    columns:
    - name: id_nota
      description: >
        Identificador único da Nota de Crédito.
    - name: id_plano_acao
      description: >
        Identificador único do Plano de Ação ao qual a Nota de Crédito está vinculada.
    - name: tx_minuta_nota
      description: >
        Texto ou rascunho da minuta da Nota de Crédito.
    - name: tx_numero_nota
      description: >
        Número da Nota de Crédito, utilizado para controle e rastreabilidade.
    - name: dt_emissao_nota
      description: >
        Data e hora da emissão da Nota de Crédito.
    - name: cd_gestao_emitente_nota
      description: >
        Código da gestão pública que emitiu a Nota de Crédito.
    - name: cd_gestao_favorecida_nota
      description: >
        Código da gestão pública favorecida pela Nota de Crédito.
    - name: tx_situacao_nota
      description: >
        Situação atual da Nota de Crédito (ex: emitida, cancelada, aprovada).
    - name: cd_ug_emitente_nota
      description: >
        Código da Unidade Gestora que emitiu a Nota de Crédito.
    - name: cd_ug_favorecida_nota
      description: >
        Código da Unidade Gestora favorecida pela Nota de Crédito.
    - name: tx_observacao_nota
      description: >
        Observações adicionais registradas na Nota de Crédito, quando houver.

  - name: programacao_financeira
    description: >
      Esta tabela armazena os registros de Programações Financeiras vinculadas aos Planos de Ação. 
      A Programação Financeira representa o planejamento e execução da alocação de recursos entre unidades gestoras. 
      A tabela contempla informações como tipo, número, situação, unidade emitente e favorecida, 
      bem como observações e o documento hábil de recebimento.
    columns:
    - name: id_programacao
      description: >
        Identificador único da Programação Financeira.
    - name: id_plano_acao
      description: >
        Identificador único do Plano de Ação ao qual a Programação Financeira está vinculada.
    - name: tp_pf_tipo_programacao
      description: >
        Tipo de Programação Financeira (ex: ordinária, suplementar, especial).
    - name: tx_minuta_programacao
      description: >
        Minuta ou rascunho da Programação Financeira.
    - name: tx_numero_programacao
      description: >
        Número da Programação Financeira, utilizado para controle interno e rastreamento.
    - name: tx_situacao_programacao
      description: >
        Situação atual da Programação Financeira (ex: em análise, aprovada, cancelada).
    - name: tx_observacao_programacao
      description: >
        Observações complementares sobre a Programação Financeira, se houver.
    - name: ug_emitente_programacao
      description: >
        Código ou nome da Unidade Gestora que emitiu a Programação Financeira.
    - name: ug_favorecida_programacao
      description: >
        Código ou nome da Unidade Gestora favorecida pela Programação Financeira.
    - name: dh_recebimento_programacao
      description: >
        Data e hora do recebimento do documento hábil relacionado à Programação Financeira.

  - name: programas
    description: >
      Esta tabela contém os registros dos Programas institucionais, que orientam e organizam os Planos de Ação
      sob responsabilidade de diferentes unidades da administração pública. A tabela agrega dados como código, 
      nome, ano, situação, descrição, objetivos e informações relacionadas às autorizações e tipos de investimentos, 
      além de indicar critérios específicos como beneficiários e chamamentos públicos.
    columns:
    - name: id_programa
      description: >
        Identificador único do Programa.
    - name: tx_codigo_programa
      description: >
        Código atribuído ao Programa para fins de controle e identificação institucional.
    - name: aa_ano_programa
      description: >
        Ano de referência do Programa.
    - name: tx_situacao_programa
      description: >
        Situação atual do Programa (ex: ativo, encerrado, em elaboração).
    - name: tx_nome_programa
      description: >
        Nome oficial do Programa.
    - name: sigla_unidade_descentralizadora
      description: >
        Sigla da unidade responsável pela descentralização dos recursos do Programa.
    - name: unidade_descentralizadora
      description: >
        Nome completo da unidade descentralizadora responsável pelo Programa.
    - name: sigla_unidade_responsavel_acompanhamento
      description: >
        Sigla da unidade responsável pelo acompanhamento do Programa.
    - name: unidade_responsavel_acompanhamento
      description: >
        Nome completo da unidade responsável pelo acompanhamento do Programa.
    - name: tx_nome_institucional_programa
      description: >
        Nome institucional utilizado oficialmente para identificar o Programa.
    - name: tx_objetivo_programa
      description: >
        Objetivo principal do Programa, descrevendo seu propósito estratégico.
    - name: tx_descricao_programa
      description: >
        Descrição detalhada do Programa, abrangendo seu escopo e diretrizes.
    - name: in_grupo_investimento_obra
      description: >
        Indicador booleano que sinaliza se o Programa está vinculado a investimento em obras.
    - name: in_grupo_investimento_servico
      description: >
        Indicador booleano que sinaliza se o Programa está vinculado a investimento em serviços.
    - name: in_grupo_investimento_equipamento
      description: >
        Indicador booleano que sinaliza se o Programa está vinculado a investimento em equipamentos.
    - name: in_autoriza_subdescentralizacao_outro
      description: >
        Indicador que informa se o Programa autoriza subdescentralização para outras unidades.
    - name: in_autoriza_realizacao_despesas
      description: >
        Indicador que informa se o Programa autoriza a realização de despesas diretamente.
    - name: in_autoriza_execucao_creditos_descentralizada
      description: >
        Indicador que informa se o Programa autoriza a execução descentralizada de créditos.
    - name: in_beneficiario_especifico
      description: >
        Indicador booleano de existência de beneficiário específico no Programa.
    - name: dt_recebimento_plano_beneficiario_inicio
      description: >
        Data de início para recebimento do plano de beneficiário específico vinculado ao Programa.
    - name: dt_recebimento_plano_beneficiario_fim
      description: >
        Data final para recebimento do plano de beneficiário específico vinculado ao Programa.
    - name: in_chamamento_publico
      description: >
        Indicador booleano de execução via chamamento público no âmbito do Programa.
    - name: dt_recebimento_plano_chamamento_inicio
      description: >
        Data de início para recebimento do plano relacionado a chamamento público.
    - name: dt_recebimento_plano_chamamento_fim
      description: >
        Data final para recebimento do plano relacionado a chamamento público.

  - name: empenhos_plano_acao
    description: >
      Esta tabela estabelece a relação entre os empenhos registrados no SIAFI e os respectivos Planos de Ação, 
      permitindo o rastreamento das despesas públicas desde a origem do crédito até sua execução. 
    columns:
    - name: ne
      description: >
        Número da Nota de Empenho, extraído dos 12 últimos dígitos do campo `ne_ccor`, representando o identificador do empenho no SIAFI.
    - name: num_transf
      description: >
        Número da transferência identificado na descrição da nota de empenho (`ne_ccor_descricao`), utilizado para vincular o empenho ao Plano de Ação correspondente.
    - name: nc
      description: >
        Código da Nota de Crédito associado ao empenho, extraído da descrição da nota de empenho e formatado conforme padrão estabelecido.
    - name: plano_acao
      description: >
        Identificador do Plano de Ação relacionado ao empenho, obtido a partir da correspondência com o número de transferência (`num_transf`).
    - name: ne_ccor
      description: >
        Campo original contendo o código completo da Nota de Empenho, utilizado como base para extração de identificadores.
    - name: ne_ccor_descricao
      description: >
        Descrição textual da Nota de Empenho, de onde são extraídos os números de transferência e códigos de nota de crédito para associação com os Planos de Ação.
    - name: demais_colunas
      description: >
        Outras colunas provenientes da tabela `empenhos_tesouro`, contendo informações adicionais sobre os empenhos, como data de emissão, valor, unidade gestora, entre outras.

  - name: nc_plano_acao
    description: >
      Esta tabela estabelece a relação entre as Notas de Crédito registradas no SIAFI e os respectivos Planos de Ação, 
      permitindo o rastreamento das movimentações financeiras desde a origem do crédito até sua aplicação. 
    columns:
    - name: plano_acao
      description: >
        Identificador do Plano de Ação relacionado à Nota de Crédito, obtido a partir da correspondência com o número de transferência (`nc_transferencia`).
    - name: emissao_dia
      description: >
        Dia de emissão da Nota de Crédito.
    - name: num_transf
      description: >
        Número da transferência associado à Nota de Crédito, utilizado para vincular a movimentação financeira ao Plano de Ação correspondente.
    - name: nc
      description: >
        Código da Nota de Crédito, extraído dos 12 últimos dígitos do campo `nc`, representando o identificador da nota no SIAFI.
    - name: nc_fonte_recursos
      description: >
        Código da fonte de recursos associada à Nota de Crédito, indicando a origem dos recursos utilizados.
    - name: ptres
      description: >
        Código do Plano Interno de Trabalho (PTRES) vinculado à Nota de Crédito, representando a ação orçamentária correspondente.
    - name: ug_emitente
      description: >
        Código da Unidade Gestora emitente da Nota de Crédito, extraído dos 6 primeiros dígitos do campo `nc`.
    - name: nc_natureza_despesa
      description: >
        Código da natureza da despesa associada à Nota de Crédito, conforme classificação orçamentária.
    - name: nc_evento
      description: >
        Código do evento contábil associado à Nota de Crédito, representando a natureza da transação.
    - name: nc_evento_descr
      description: >
        Descrição do evento contábil vinculado à Nota de Crédito.
    - name: nc_valor
      description: >
        Valor monetário da Nota de Crédito, ajustado conforme o tipo de evento contábil.

  - name: pf_plano_acao
    description: >
      Esta tabela consolida as programações financeiras executadas no âmbito do SIAFI que estão relacionadas a Planos de Ação.
    columns:
    - name: pf
      description: >
        Número identificador da Programação Financeira, conforme registrado no SIAFI.
    - name: num_transf
      description: >
        Número da transferência extraído do campo `pf_inscricao`, utilizado como chave alternativa para vinculação com Planos de Ação.
    - name: emissao_mes
      description: >
        Mês da emissão da Programação Financeira, no formato numérico (1 a 12).
    - name: emissao_dia
      description: >
        Dia da emissão da Programação Financeira, no formato numérico (1 a 31).
    - name: ug_emitente
      description: >
        Código da Unidade Gestora responsável pela emissão da Programação Financeira.
    - name: ug_favorecido
      description: >
        Código da Unidade Gestora favorecida pela Programação Financeira.
    - name: pf_evento
      description: >
        Código do evento contábil associado à Programação Financeira, que descreve o tipo de movimentação registrada.
    - name: pf_evento_descricao
      description: >
        Descrição do evento contábil da Programação Financeira, fornecendo contexto adicional sobre o tipo de operação realizada.
    - name: pf_acao
      description: >
        Código da ação orçamentária extraído da descrição da programação financeira, representando a finalidade da despesa.
    - name: pf_valor_linha
      description: >
        Valor programado para execução financeira, referente à linha específica da Programação Financeira.
    - name: plano_acao
      description: >
        Identificador do Plano de Ação associado à Programação Financeira, determinado por correspondência direta com o sistema TransfereGov ou via número de transferência.

  - name: ted_resumo_orcamentario
    description: >
      Tabela de consolidação orçamentária e financeira por Plano de Ação, baseada em informações de valores firmados, orçamentos recebidos e devolvidos, empenhos, despesas e transferências financeiras. 
      Os dados são integrados de diferentes fontes (notas de crédito, empenhos e programações financeiras) para fornecer um resumo abrangente da execução orçamentária e financeira de transferências intergovernamentais.
    columns:
    - name: plano_acao
      description: >
        Identificador único do Plano de Ação associado aos registros orçamentários e financeiros.
    - name: num_transf
      description: >
        Número da transferência utilizado como chave de ligação entre diferentes fontes de dados.
    - name: sigla_unidade_descentralizada
      description: >
        Sigla da Unidade Descentralizada responsável pelo Plano de Ação.
    - name: ted_beneficiario_emitente
      description: >
        Identifica se a Unidade do Plano de Ação é a beneficiária ou a emitente dos recursos da TED (Transferência Voluntária). Valores possíveis: 'beneficiario', 'emitente' ou 'nao_indicado'.
    - name: valor_firmado
      description: >
        Valor total originalmente acordado no Plano de Ação como meta de transferência de recursos.
    - name: orcamento_recebido
      description: >
        Total de créditos orçamentários efetivamente recebidos por meio de Notas de Crédito.
    - name: orcamento_devolvido
      description: >
        Total de créditos orçamentários devolvidos, identificado por eventos contábeis específicos (ex.: 300301, 300307).
    - name: empenhado
      description: >
        Soma dos valores empenhados, ou seja, das despesas formalizadas no orçamento, excluindo anulações.
    - name: empenho_anulado
      description: >
        Total de valores de empenhos anulados, ou seja, revertidos após sua emissão.
    - name: despesas_pagas_exercicio
      description: >
        Total de despesas pagas no exercício corrente.
    - name: despesas_pagas_rap
      description: >
        Total de despesas pagas com recursos de Restos a Pagar.
    - name: restos_a_pagar
      description: >
        Valor total inscrito como Restos a Pagar, ou seja, despesas empenhadas e não pagas até o fim do exercício.
    - name: despesas_liquidada
      description: >
        Soma das despesas liquidadas, indicando bens ou serviços efetivamente entregues.
    - name: financeiro_recebido
      description: >
        Total de recursos financeiros recebidos via Programação Financeira (TED), considerando apenas ações classificadas como 'TRANSFERENCIA'.
    - name: financeiro_devolvido
      description: >
        Total de recursos financeiros devolvidos, com ações classificadas como 'DEVOLUCAO'.
    - name: financeiro_cancelado
      description: >
        Valor total de cancelamentos financeiros identificados na programação, com ação 'CANCELAMENTO'.

  - name: num_transf_n_plano_acao
    description: >
      View responsável por mapear o número de transferência (`num_transf`) ao respectivo Plano de Ação (`plano_acao`). 
      Utiliza dados de Notas de Crédito do TransfereGov e do SIAFI para realizar o cruzamento entre diferentes sistemas.
    columns:
    - name: num_transf
      description: >
        Número da transferência financeira obtido a partir dos registros do SIAFI (nota de crédito). Serve como chave para integrar informações entre diferentes fontes, como notas de crédito, programações financeiras e empenhos.
    - name: plano_acao
      description: >
        Identificador único do Plano de Ação, conforme registrado no TransfereGov. É atribuído ao `num_transf` com base no cruzamento entre a nota de crédito (NC) e a unidade gestora emitente (UG).

macros:
  - name: create_udfs
    description: >
      Função que cria as UDFs necessárias para o funcionamento do projeto.
      Essa função deve ser chamada no início de cada run para garantir que todas as UDFs estejam disponíveis.
  
  - name: generate_schema_name
    description: >
      Função que gera o nome do schema a ser utilizado no projeto.
      A função dentro desta macro é built-in do dbt.
  
  ## UDFS
  - name: create_f_parse_dates
    description: >
      Função que cria a UDF f_parse_dates, que é utilizada para converter texto no formato MÊS(texto)/ANO(numero) em datas.
    arguments:
      - name: in_text
        type: text
        description: >
          Texto a ser convertido em data.
          O texto deve estar no formato MÊS(texto)/ANO(numero). Ex.: FEV/2024 -> 2024-02-01